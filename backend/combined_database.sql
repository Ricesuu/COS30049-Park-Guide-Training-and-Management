-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1
-- Generation Time: May 16, 2025 at 04:05 AM
-- Server version: 10.4.32-MariaDB
-- PHP Version: 8.2.12

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `park_guide_management`
--

CREATE DATABASE IF NOT EXISTS `park_guide_management`;
USE `park_guide_management`;

-- --------------------------------------------------------

--
-- Table structure for table `activealerts`
--

CREATE TABLE IF NOT EXISTS `activealerts` (
  `alert_id` int(11) NOT NULL,
  `park_id` int(11) NOT NULL,
  `sensor_type` varchar(50) NOT NULL,
  `recorded_value` varchar(50) NOT NULL,
  `threshold_id` int(11) NOT NULL,
  `message` varchar(255) NOT NULL,
  `severity` enum('low','medium','high') NOT NULL,
  `is_acknowledged` tinyint(1) DEFAULT 0,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `alertthresholds`
--

CREATE TABLE IF NOT EXISTS `alertthresholds` (
  `threshold_id` int(11) NOT NULL,
  `sensor_type` varchar(50) NOT NULL,
  `park_id` int(11) NOT NULL,
  `min_threshold` float DEFAULT NULL,
  `max_threshold` float DEFAULT NULL,
  `trigger_message` varchar(255) NOT NULL,
  `severity` enum('low','medium','high') NOT NULL DEFAULT 'medium',
  `is_enabled` tinyint(1) DEFAULT 1,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `alertthresholds`
--

INSERT INTO `alertthresholds` (`threshold_id`, `sensor_type`, `park_id`, `min_threshold`, `max_threshold`, `trigger_message`, `severity`, `is_enabled`, `created_at`, `updated_at`) VALUES
(1, 'temperature', 1, 20, 32, 'Temperature threshold exceeded', 'medium', 1, '2025-05-15 02:38:38', '2025-05-15 02:38:38'),
(2, 'temperature', 2, 20, 32, 'Temperature threshold exceeded', 'medium', 1, '2025-05-15 02:38:38', '2025-05-15 02:38:38'),
(3, 'humidity', 1, 40, 80, 'Humidity threshold exceeded', 'medium', 1, '2025-05-15 02:38:38', '2025-05-15 02:38:38'),
(4, 'humidity', 2, 40, 80, 'Humidity threshold exceeded', 'medium', 1, '2025-05-15 02:38:38', '2025-05-15 02:38:38'),
(5, 'soil moisture', 1, 30, 31, 'Soil moisture threshold exceeded', 'high', 1, '2025-05-15 02:38:38', '2025-05-15 02:38:38'),
(6, 'soil moisture', 2, 30, 31, 'Soil moisture threshold exceeded', 'high', 1, '2025-05-15 02:38:38', '2025-05-15 02:38:38'),
(7, 'motion', 1, NULL, NULL, 'Unauthorized motion detected', 'high', 1, '2025-05-15 02:38:38', '2025-05-15 02:38:38'),
(8, 'motion', 2, NULL, NULL, 'Unauthorized motion detected', 'high', 1, '2025-05-15 02:38:38', '2025-05-15 02:38:38');

-- --------------------------------------------------------

--
-- Table structure for table `certifications`
--

CREATE TABLE IF NOT EXISTS `certifications` (
  `cert_id` int(11) NOT NULL,
  `guide_id` int(11) NOT NULL,
  `module_id` int(11) NOT NULL,
  `issued_date` date NOT NULL,
  `expiry_date` date NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `guidebook`
--

CREATE TABLE IF NOT EXISTS `guidebook` (
  `guidebook_id` int(11) NOT NULL,
  `park_id` int(11) NOT NULL,
  `title` varchar(255) NOT NULL,
  `content` text NOT NULL,
  `multimedia_links` text DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `guidebook`
--

INSERT INTO `guidebook` (`guidebook_id`, `park_id`, `title`, `content`, `multimedia_links`) VALUES
(1, 1, "Exploring Bako National Park: A Visitor's Guide", 'Discover the diverse ecosystems, flora, and fauna of Bako National Park. Includes tips for hiking, wildlife spotting, and safety precautions.', 'bako_guide_video_links, bako_maps_links'),
(2, 2, 'Semenggoh Wildlife Centre: Orangutan Conservation and Visitor Tips', 'Learn about the history, mission, and highlights of Semenggoh Wildlife Centre, with tips for observing wildlife responsibly and engaging in conservation efforts.', 'semenggoh_video_links, semenggoh_facts_links');

-- --------------------------------------------------------

--
-- Table structure for table `guidetrainingprogress`
--

CREATE TABLE IF NOT EXISTS `guidetrainingprogress` (
  `progress_id` int(11) NOT NULL,
  `guide_id` int(11) NOT NULL,
  `module_id` int(11) NOT NULL,
  `status` enum('in progress','Completed') DEFAULT 'in progress',
  `completion_date` date DEFAULT NULL,
  `start_date` date DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `iotmonitoring`
--

CREATE TABLE IF NOT EXISTS `iotmonitoring` (
  `sensor_id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `park_id` int(11) NOT NULL,
  `sensor_type` enum('temperature','humidity','soil moisture','motion') NOT NULL,
  `recorded_value` varchar(255) NOT NULL,
  `recorded_at` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `iotmonitoring`
--

INSERT INTO `iotmonitoring` (`sensor_id`, `park_id`, `sensor_type`, `recorded_value`, `recorded_at`) VALUES
(1, 1, 'temperature', '24.5', '2025-05-14 16:38:38'),
(2, 1, 'temperature', '25.2', '2025-05-14 17:38:38'),
(3, 1, 'temperature', '26.8', '2025-05-14 18:38:38'),
(4, 1, 'temperature', '28.3', '2025-05-14 19:38:38'),
(5, 1, 'temperature', '29.5', '2025-05-14 20:38:38'),
(6, 1, 'temperature', '30.1', '2025-05-14 21:38:38'),
(7, 1, 'temperature', '30.2', '2025-05-14 22:38:38'),
(8, 1, 'temperature', '29.8', '2025-05-14 23:38:38'),
(9, 1, 'temperature', '28.5', '2025-05-15 00:38:38'),
(10, 1, 'temperature', '27.7', '2025-05-15 01:38:38'),
(11, 1, 'humidity', '75%', '2025-05-14 16:38:38'),
(12, 1, 'humidity', '72%', '2025-05-14 17:38:38'),
(13, 1, 'humidity', '68%', '2025-05-14 18:38:38'),
(14, 1, 'humidity', '65%', '2025-05-14 19:38:38'),
(15, 1, 'humidity', '62%', '2025-05-14 20:38:38'),
(16, 1, 'humidity', '60%', '2025-05-14 21:38:38'),
(17, 1, 'humidity', '61%', '2025-05-14 22:38:38'),
(18, 1, 'humidity', '64%', '2025-05-14 23:38:38'),
(19, 1, 'humidity', '68%', '2025-05-15 00:38:38'),
(20, 1, 'humidity', '71%', '2025-05-15 01:38:38');

-- --------------------------------------------------------

--
-- Table structure for table `multilicensetrainingexemptions`
--

CREATE TABLE IF NOT EXISTS `multilicensetrainingexemptions` (
  `exemption_id` int(11) NOT NULL,
  `guide_id` int(11) NOT NULL,
  `training_id` int(11) NOT NULL,
  `exempted_training_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `parks`
--

CREATE TABLE IF NOT EXISTS `parks` (
  `park_id` int(11) NOT NULL,
  `park_name` varchar(255) NOT NULL,
  `location` text NOT NULL,
  `description` text DEFAULT NULL,
  `wildlife` text DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `parks`
--

INSERT INTO `parks` (`park_id`, `park_name`, `location`, `description`, `wildlife`) VALUES
(1, 'Bako National Park', 'Sarawak, Malaysia', 'Bako National Park is known for its diverse ecosystems, ranging from mangroves to rainforest, and its stunning coastline.', 'Proboscis monkeys, bearded pigs, otters, and various bird species'),
(2, 'Semenggoh Wildlife Centre', 'Kuching, Sarawak, Malaysia', 'Semenggoh Wildlife Centre is a sanctuary for rehabilitated orangutans, providing visitors with a chance to observe these magnificent creatures in their natural habitat.', 'Orangutans, gibbons, crocodiles, and local birdlife');

-- --------------------------------------------------------
--
-- Table structure for table `users`
--

CREATE TABLE IF NOT EXISTS `users` (
  `user_id` int(11) NOT NULL PRIMARY KEY AUTO_INCREMENT,
  `uid` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL,
  `first_name` varchar(255) NOT NULL,
  `last_name` varchar(255) NOT NULL,
  `role` enum('admin','park_guide') NOT NULL DEFAULT 'park_guide',
  `status` enum('pending','approved','rejected','deleted') DEFAULT 'pending',
  `failed_attempts` int(11) DEFAULT 0,
  `last_failed_attempt` datetime DEFAULT NULL,
  `locked_until` datetime DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `deleted_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `users`
--

INSERT INTO `users` (`user_id`, `uid`, `email`, `first_name`, `last_name`, `role`, `status`, `failed_attempts`, `last_failed_attempt`, `locked_until`, `created_at`) VALUES
(1, 'vTJ6RpxoDeOP83TKZZjONPyUhX13', 'theadmin@gmail.com', 'Admin', 'Wong', 'admin', 'approved', 0, NULL, NULL, '2025-05-15 02:38:38'),
(2, 'ajxMEqjwGJROneaRDLFFIBisL8b2', 'parkguide@gmail.com', 'SkibidiRui', 'Wahwah', 'park_guide', 'approved', 0, NULL, NULL, '2025-05-15 06:31:20');

-- --------------------------------------------------------
--
-- Table structure for table `paymenttransactions`
--

CREATE TABLE IF NOT EXISTS `paymenttransactions` (
  `payment_id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `user_id` int(11) NOT NULL,
  `uid` varchar(255) NOT NULL,
  `paymentPurpose` varchar(100) NOT NULL,
  `paymentMethod` enum('debit','credit','e_wallet') NOT NULL,
  `amountPaid` decimal(10,2) NOT NULL,
  `receipt_image` longblob NOT NULL,
  `paymentStatus` enum('pending','approved','rejected') DEFAULT 'pending',
  `transaction_date` timestamp NOT NULL DEFAULT current_timestamp(),
  `module_id` int(11) DEFAULT NULL,
  FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `paymenttransactions`
--

INSERT INTO `paymenttransactions` (`payment_id`, `user_id`, `uid`, `paymentPurpose`, `paymentMethod`, `amountPaid`, `receipt_image`, `paymentStatus`, `transaction_date`, `module_id`) VALUES
(1, 2, 'ajxMEqjwGJROneaRDLFFIBisL8b2', 'registration_and_enrollment', 'debit', 250.00, 0xffd8ffe102014578696600004d4d002a0000000800070100000400000001000005a0011000020000001400000062010100040000000100000780010f0002000000070000007687690004000000010000009101120004000000010000000001320002000000140000007d0000000073646b5f6770686f6e6536345f7838365f363400476f6f676c6500323032353a30353a30382030313a34393a333100000f90000002000000050000014b920200050000000100000150882700030000000100640000929200020000000430353800900300020000001400000158929100020000000430353800a4030003000000010000000090040002000000140000016c9201000a0000000100000180920a00050000000100000188829a00050000000100000190920900030000000100000000929000020000000430353800920800030000000100000000829d000500000001000001980000000030323230000000009e00000064323032353a30353a30382030313a34393a333100323032353a30353a30382030313a34393a3331000000228a000003e80000111c000003e80000001500002710000043940000271000030110000200000014000001ca010f000200000007000001de0132000200000014000001e50000000073646b5f6770686f6e6536345f7838365f363400476f6f676c6500323032353a30353a30382030313a34393a333100ffe000104a46494600010100000100010000ffe201d84943435f50524f46494c45000101000001c800000000043000006d6e74725247422058595a2007e00001000100000000000061637370000000000000000000000000000000000000000000000000000000010000f6d6000100000000d32d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000964657363000000f0000000247258595a00000114000000146758595a00000128000000146258595a0000013c00000014777470740000015000000014725452430000016400000028675452430000016400000028625452430000016400000028637072740000018c0000003c6d6c756300000000000000010000000c656e5553000000080000001c007300520047004258595a200000000000006fa2000038f50000039058595a2000000000000062990000b785000018da58595a2000000000000024a000000f840000b6cf58595a20000000000000f6d6000100000000d32d706172610000000000040000000266660000f2a700000d59000013d000000a5b00000000000000006d6c756300000000000000010000000c656e5553000000200000001c0047006f006f0067006c006500200049006e0063002e00200032003000310036ffdb0043000a07070807060a0808080b0a0a0b0e18100e0d0d0e1d15161118231f2524221f2221262b372f26293429212230413134393b3e3e3e252e4449433c48373d3e3bffdb0043010a0b0b0e0d0e1c10101c3b2822283b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3bffc0001108078005a003012200021101031101ffc4001c0001000203010101000000000000000000000106040507030802ffc4003410010000010906050402030101000000000001020304166491a3d1e10512141552533254719293314155d261a20611513344ffc4001a010101010101010100000000000000000000010504030206ffc400221101000201050101010101010000000000000131510211121314036141522104ffda000c03010002110311003f00ea40325cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000803cf7e26fc5cfe9d29bbd079efc4df89e9d29c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e83cf7e26fc4f4e9393d079efc4df89e9d2727a0f3df89bf13d3a4e4f41e7bf137e27a749c9e803a5f4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009343c63f508fd4644dbcc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ec0361e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009343c63f508fd4644dbcc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ec0361e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009343c63f508fd4644dbcc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ec0361e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009343c63f508fd4644dbcc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ec0361e80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002bf5a6c589a2c0a0037f5a6c589a15a6c589a340037f5a6c589a15a6c589a340037f5a6c589a15a6c589a340037f5a6c589a15a6c589a34024d0ded65b1e2688acb63c4d1a318d33ff005e1bcb79596c789a1596c789a34626e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2de565b1e268565b1e268d186e6f2bf80db7b8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a02fea000000000000024d000c59b738020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf80dc740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a02fea000000000000024d000c59b738020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf80dc740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a02fea000000000000024d000c59b738020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf80dc740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a02fea000000000000024d000c59b73802000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f6e8fa7f995da400e8faff9938c801d1f5ff32719003a3ebfe64e3200747d7fcc9c6400e8faff009938c801d1f5ff0032719003a3ebfe64e3200747d7fcc9c657f01acf70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001405fd4000000000000049a0018b36e7004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f5164003f5514e98a00500000000000000000000017f019c8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000280bfa80000000000000934003166dce008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003ea2c8007eaa29d31400a0000000000000000000002fe033900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005017f5000000000000012680062cdb9c010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007d459000fd5453a6280140000000000000000000005fc06720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a02fea000000000000024d000c59b73802000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fa8b2001faa8a74c50028000000000000000000000bf80ce40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001405fd4000000000000049a0018b36e7004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f516402843f5514e98a5f4508517d142017d142017d142017d142017d142017d142017d14201df006720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a02fea000000000000024d000c59b73802000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fa8b214201faa8a74c50028000000000000000000000ef8033900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005017f5000000000000012680062cdb9c010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007d4590a100fd5453a62801400000000000000000000077c019c8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000280bfa80000000000000934003166dce008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003ea2c850807eaa29d31400a0000000000000000000003be00ce40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001405fd4000000000000049a0018b36e7004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001f516aa100fd5453a22801400000000000000000000077c019c80000000000000000000000000000000000000000000000000000000000000002a1cf769f99c39392dea00361cf769f99c39391cf769f99c393935e0361cf769f99c39391cf769f99c393935e0361cf769f99c39391cf769f99c393935e0361cf769f99c39391cf769f99c393935e0b0d873dda7e670e4e473dda7e670e4e4d78f7da1d5c630d873dda7e670e4e473dda7e670e4e4d786d0718c361cf769f99c39391cf769f99c393935e1b41c630d873dda7e670e4e473dda7e670e4e4d786d0718c361cf769f99c393935e06d0718c001b41c630006d0718c001b41c630006d1838c6001f1d3f3c270d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a700074fcf1070d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a700074fcf1070d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a700074fcf1070d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a700074fcf1070d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a700074fcf1070d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a700074fcf1070d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a700074fcf1070d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a700074fcf1070d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a700074fcf1070d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a700074fcf1070d38003a7e7883869c001d3f3c41c34e000e9f9e20e1a7000757cf070d3850807aef2bc630006f2bc630006f2718c001bc9c630006f2718c001bc9c630006f2718c001bc9c630006f2718c3be00e6718000000000000000000000000000000000000000000000000000000000000000a02fea00000000000001045803a21db14000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a1000000000000000000000000000ef8039dc4000000000000000000000000000000000000000000000000000000000000000280bfa80000000000000411600e8876c5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000284000000000000000000000000003be00e7710000000000000000000000000000000000000000000000000000000000000000a02fea00000000000001045803a21db14000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a1000000000000000000000000000ef8039dc4000000000000000000000000000000000000000000000000000000000000000280bfa8000000000000041160d1565b1e268565b1e268e8876c537a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a037a345596c789a1596c789a02be2773f9373f90409dcfe4dcfe4102773f9373f90409dcfe4dcfe4102773f9373f90409dcfe4dcfe4102773f9373f90409dcfe4dcfe4102773f9373f9077b01cee20000000000000000000000000000000000000000000000000000000000000001405fd40000000000000208b51807443b628000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001de0073b880000000000000000000000000000000000000000000000000000000000000005017f500000000000000822d4601d10ed8a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077801cee20000000000000000000000000000000000000000000000000000000000000001405fd40000000000000208b51807443b628000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001de0073b880000000000000000000000000000000000000000000000000000000000000005017f50000000000000022d4601d10ed8a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077801cee20000000000000000000000000000000000001afe7bb33ccff4959360a002dfcf766799fe92b239eeccf33fd2564a800b7f3dd99e67fa4ac8e7bb33ccff0049592a002dfcf766799fe92b239eeccf33fd2564a800b7f3dd99e67fa4ac8e7bb33ccff49592a024d0b7f3dd99e67fa4ac8e7bb33ccff49592a033e7ff0056b79f395bf9eeccf33fd256473dd99e67fa4ac95013d5ad39cadfcf766799fe92b239eeccf33fd2564a807ab59ce56fe7bb33ccff0049591cf766799fe92b25403d5ace72b7f3dd99e67fa4ac95003d5ace72007ab59ce400f56b39c801ead67390058ffd5af758d73ba8c036629a1140028000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003bc00e7710000000000000000000000000000000000000a02fea000000000000024d000c59b73802000000000000000000000fa8b58b51807e8629a71400aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ef0039dc4000000000000000000000000000000000000280bfa80000000000000934003166dce008000000000000000000003ea2d62d4601fa18a69c5002a8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003bc00e7710000000000000000000000000000000000000a02fea000000000000024d000c59b73802000000000000000000000fa8b58b51807e8629a71400aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ef0039dc4000000000000000000000000000000000000280bfa80000000000000934003166dce008000000000000000000003ea2d62d4601fa18a69c5002a8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003bc00e7710000000000000000000000000000000000000a02fea000000000000024d000c59b73802000000000000000000000fa8b58b51807e8629a71400aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ef0039dc4000000000000000000000000000000000000280bfa80000000000000934003166dce008000000000000000000003ea2d62d4601fa18a69c5002a8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003bc00e7710000000000000000000000000000000000000a02fea000000000000024d000c59b73802000000000000000000000fa8b58b51807e8629a71400aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ef0039dc4000000000000000000000000000000000000280bfa80000000000000934003166dce008000000000000000000003ea2d62d4601fa18a69c5002a8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003bc00e7710000000000000000000000000000000000000a02fea000000000000024d000c59b73802000000000000000000000b16b0a309dd81bb06cc7fe9d3b53ae3ff469409dd81bb05f4e9c2fa74a04eec0dd81e9d383d3a50277606ec0f4e9c1e9d2813bb037607a74e0f4e9409dd81bb03d3a707a74a04eec0dd81e9d383d3a50277606ec0f4e9c1e9d2813bb0374f4e9c27a74a007af643cfdbf3c4801d909edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e2400ec83dbf3c4801d907b7e789003b20f6fcf12007641edf9e25de0079a8000000000000000000000000000000000000a02fea000000000000024d000c59b73802000000000000000000000a29003ad000000000000000000000001525f901d914e2900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077801f6d70000000000000000000000000000000000001405fd4000000000000049a0018b36e70040000000000000000000014520075a000000000000000000000002a4bf203b229c52000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ef003edae000000000000000000000000000000000000280bfa80000000000000934003166dce0080000000000000000000028a400eb4000000000000000000000005497e40764538a4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001de007db5c0000000000000000000000000000000000005017f5000000000000012680062cdb9c01000000000000000000000514801d6800000000000000000000000a92fc80ec8a7148000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003bc00fb6b8000000000000000000000000000000000000a02fea000000000000024d000c59b738020000000000000000000000d5d5ea1f727af86455ea1f727af864da0fbe7ab235757a87dc9ebe19157a87dc9ebe193681cf5646aeaf50fb93d7c322af50fb93d7c326d039eac8d5d5ea1f727af86455ea1f727af864da073d591ababd43ee4f5f0c9a9e0a6ff00eca5a95c39eac8f0e0e6ff00eca3839bff00b29ee2f3d591e1c1cdff00d9470737ff00653dc39eac8f0e0e6ffeca3839bffb29ee1cf5647870737ff651c1cd7fd94f708d7ab2934c7e066baa5de70335d52ef640d58a70cb1f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd90031f819aea9779c0cd754bbd9003b100fb6b8000000000000000000000000000000000000a02fea000000000000024d000c59b7380200000000000000000000000000000000002b8b1ab8a000000000002c593400d78a704d8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b100fb6b8000000000000000000000000000000000000a02fea000000000000024d000c59b7380200000000000000000000000000000000002b8b1ab8a000000000002c593400d78a704d8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b100fb6b8000000000000000000000000000000000000a02fea000000000000024d000c59b7380200000000000000000000000000000000002b8b1ab8a000000000002c593400d78a704d8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b10c2e6b47e89cba199cd68fd139743339e9cb5b78668c2e6b47e89cba199cd68fd139743339e9c9bc33461735a3f44e5d0cce6b47e89cba199cf4e4de19a30b9ad1fa272e866735a3f44e5d0cce7a726f0cd185cd68fd139743339ad1fa272e86673d39378668c2e6b47e89cba199cd68fd139743339e9c9bc33461735a3f44e5d0cce6b47e89cba199cf4e4de19a30b9ad1fa272e866735a3f44e5d0cce7a726f0cd185cd68fd139743339ad1fa272e86673d39378668c2e6b47e89cba199cd68fd139743339e9c9bc33461735a3f44e5d0cce6b47e89cba199cf4e4de19a30b9ad1fa272e866735a3f44e5d0cce7a726f0cd185cd68fd139743339ad1fa272e86673d3937866a80b9735a3f44e5d0cdcef9f513b73d743339e9c9bc36435bcfa89db9eba199cfa89db9eba199cf4e4de1b21ade7d44edcf5d0cce7d44edcf5d0cce7a726f0d90d6f3ea276e7ae86673ea276e7ae86673d393786c86b79f513b73d743339f513b73d7433275e9dacde1b21ade7f44edcf5d0cce7f44edcf5d0cd973f2d7bd3c766c86b79fd13b73d743339fd13b73d74334ead78366c86b79fd13b73d743339fd13b73d74333ab5e0d9b21ade7f44edcf5d0cce7f44edcf5d0ccead78366c86b79fd13b73d743339fd13b73d74333ab5e0d9b21ade7f44edcf5d0cce7f44edcf5d0ccead78366c86b79fd13b73d743339fd13b73d74333ab5e0d9b21ade7f44edcf5d0cce7f44edcf5d0ccead78366c86b79fd13b73d743339fd13b73d74333ab5e0d9b21ade7f44edcf5d0cce7f44edcf5d0ccead78366c86b79fd13b73d743339fd13b73d74333ab5e0d9b21ade7f44edcf5d0cce7f44edcf5d0ccead78366c86b79fd13b73d743339fd13b73d74333ab5e0d9b2571b1e7f44edcf5d0cdae5ead7836003ab5e0d800ead7836003ab5e0d80163e5af0931ff00001a514e09b005000000000000000000000001f7c3561e9d5af00070d583ab5e2400e1ab0756bc4801c3560ead78900386ac1d5af120070d583ab5e2400e1ab0756bc4801c3560ead78900386ac1d5af000f879800000000000000000000000003d3ab5e1e9d5af000756bc1d5af1200756bc1d5af1200756bc1d5af1200756bc1d5af1200756bc1d5af1200756bc1d5af1200756bc1d5af1200756bc1d5af000f379800000000000000000000000003ef86ac3d3ab5e000e1ab0756bc4801c3560ead78900386ac1d5af120070d583ab5e2400e1ab0756bc4801c3560ead78900386ac1d5af120070d583ab5e257f0194eb0000000000000000000000000000000000001cc9d35cc96000500000004250b160035629e800a0000000000000000000000000000000000cf6033c001000000500112401e2cd9b0000000000000000000000058b58b006a4537e28015400000000000000000001269268019736c09b00440000000000000000000058b58b006f4537e28015400000000000000000001269268018336c09b00440000000000000000000058b58b006a4537e2801540000000000000000000017f01f97668000000000000000000000000000000000000e64e9ae64b00028000000212858b001ab14f4005000000000000000000000000000000000067b019e00000000000089200f166cd800000000000000000000002c5ac58035229bf1400aa0000000000000000000093493400cb9b604d8022000000000000000000002c5ac58037a29bf1400aa0000000000000000000093493400c19b604d8022000000000000000000002c5ac58035229bf1400aa000000000000000000000bf80fcbb3400000000000000000000000000000000000073274d73258001400000010942c5800d58a7a002800000000000000000000000000000000033d80cf0000000000004490078b366c0000000000000000000000162d62c01a914df8a00550000000000000000000049a49a0065cdb026c01100000000000000000000162d62c01bd14df8a00550000000000000000000049a49a0060cdb026c01100000000000000000000162d62c01a914df8a00550000000000000000000005fc07e5d9a0000000000000000000000000000000000003993a6b992c000a000000084a162c006ac53d001400000000000000000000000000000000019ec067800000000000224803c59b3600000000000000000000000b16b1600d48a6fc5002a8000000000000000000024d24d0032e6d8136008800000000000000000000b16b1600de8a6fc5002a8000000000000000000024d24d003066d8136008800000000000000000000b16b1600d48a6fc5002a8000000000000000000002fe03f2ecd0000000000000000000000000000000000001cc9d35cc96000500000004250b160035629e800a0000000000000000000000000000000000cf6033c00000000000112401e2cd9b0000000001e1c7d0bce4c7c90cdeee7d18c7fdc5e9a34727afcf446add7ae6142f3931f243339850bce4c7c90cd451e9d50f5e88caf5cc285e7263e4866730a179c98f9219a8a1d50744657ae6142f3931f243339850bce4c7c90cd450ea83a232bd730a179c98f9219a398507ce4c7c90cd46447e9123e5047c637b5e39aecef3f46f964e6734d9bf90a2fcd2737388fd6287735a29d239a6cdfc8517e69399cd366fe428bf349cdcdc15d239a6cdfc8517e69399cd366fe428bf349cdcdc0748e69b37f2145f9a4e6734d9bf90a2fcd27373701d239a6cdfc8517e69399cd366fe428bf349cdcdc0748e69b37f2145f9a4e6734d9bf90a2fcd27373701d239a6cdfc8517e69399cd366fe428bf349cdcdc0748e69b37f2145f9a4e6734d9bf90a2fcd27373701d239a6cdfc8517e69399cd36747ffbe8df2c9cdcdd30f143d4949a751019536c09b00440000001e7c44c77e6fdd07a2ba0df71131df9bf740e2263bf37ee8342037dc44c77e6fdd038898efcdfba0d080df71131df9bf740e2263bf37ee8342037dc44c77e6fdd038898efcdfba0d08b16b16df71131df9bf740e2263bf37ee834237a29bf14df71131df9bf740e2263bf37ee83422ab7dc44c77e6fdd038898efcdfba0d080df71131df9bf740e2263bf37ee8342037dc44c77e6fdd038898efcdfba0d080df71131df9bf740e2263bf37ee8342037dc44c77e6fdd038898efcdfba0d080df71131df9bf740e2263bf37ee8342037dc44c77e6fdd038898efcdfba0d08934934b100c19b604d8022000000000000000000002c5ac5b179a6ce87ff007d1be59399cd366fe428bf349cdce23e28faa1ab14df8a748e69b37f2145f9a4e6734d9bf90a2fcd27373705748e69b37f2145f9a4e6734d9bf90a2fcd27373701d239a6cdfc8517e69399cd366fe428bf349cdcdc0748e69b37f2145f9a4e6734d9bf90a2fcd27373701d239a6cdfc8517e69399cd366fe428bf349cdcdc0748e69b37f2145f9a4e6734d9bf90a2fcd27373701d239a6cdfc8517e69399cd366fe428bf349cdcdc0748e69b37f2145f9a4e6734d9bf90a2fcd27373701f4880fcbb3400000000000000000000000000000000000073274d73258001400000010942c5800d58a7a002800000000000000000000000000000000033d80cf0000000000004490078b366c00000000073e8ba0b9f45eff1feba3e1fd400f6748000002511fa45288fd2210c0fba13f743a5df000280000000000000000009878a1ea84c3c50f51269d440654db026c01100000005756257400000000000162d62c01bd14df8a00550000000000000000000049a49a588060cdb026c01100000000000000000000162d62dcba3e28faa131f147d50d56fc5000a000000000000000000000fa4407e5d9a0000000000000000000000000000000000003993a6b992c000a000000084a162c006ac53d001400000000000000000000000000000000019ec067800000000000224803c59b3600000000039f45d05cfa2f7f8ff005d1f0fea007b3a4000001288fd229447e9108607dd09fba1d2ef800140000000000000000004c3c50f54261e287a8934ea2032a6d813600880000002bab12ba000000000000b16b1600de8a6fc5002a8000000000000000000024d24d2c403066d8136008800000000000000000000b16b16e5d1f147d5098f8a3ea86ab7e280050000000000000000000007d2203f2ecd0000000000000000000000000000000000001cc9d35cc96000500000004250b160035629e800a0000000000000000000000000000000000cf6033c00000000000112401e2cd9b0000000001cfa2e82e7d17bfc7fae8f87f5003d9d20000009447e914a23f4884303ee84fdd0e977c000a000000000000000000261e287aa130f143d449a751019536c09b004400000015d5895d00000000000058b58b006f4537e2801540000000000000000000126926962018336c09b00440000000000000000000058b58b72e8f8a3ea84c7c51f54355bf140028000000000000000000003e9101f97668000000000000000000000000000000000000e64e9ae64b00028000000212858001a9131b3d001778000de000378000de000378000de000378000de0005000000000067b019e00000000000089200f166cd8000000000e7d174173e8bdfe3fd747c3fa801ece90000004a23f48a511fa442181f7427ee874bbe0005000000000000000000130f143d509878a1ea24d3a880ca9b604d80220000000aeac4ae8000000000002c5ac58037a29bf1400aa00000000000000000000934934b100c19b604d8022000000000000000000002c5ac5b9747c51f54263e28faa1aadf8a0014000000000000000000001f4880fcbb3400000000000000000000000000000000000073274d7325800140000000004091779102437910243791024379102437910243791024379102437910250b133b800d48a7a002800000033d80cf0000000000004490078b366c00000000073e8ba0b9f45eff1feba3e1fd400f6748000002511fa45288fd2210c0fba13f743a5df000280000000000000000009878a1ea84c3c50f51269d440654db026c01100000005756257400000000000162d62c01bd14df8a00550000000000000000000049a49a588060cdb026c01100000000000000000000162d62dcba3e28faa131f147d50d56fc5000a000000000000000000000fa4407e5d9a0000000000000000000000000000000000003993a6b992c000a000000000000000000000000000000000084a162c006ac53d001400000019ec067800000000000224803c59b3600000000039f45d05cfa2f7f8ff005d1f0fea007b3a4000001288fd229447e9108607dd09fba1d2ef800140000000000000000004c3c50f54261e287a8934ea2032a6d813600880000002bab12ba000000000000b16b1600de8a6fc5002a8000000000000000000024d24d2c403066d8136008800000000000000000000b16b16e5d1f147d5098f8a3ea86ab7e280050000000000000000000007d2203f2ecd0000000000000000000000000000000000001cc9d35cc96000500000000000000000000000000000000004250b160035629e800a0000000cf6033c00000000000112401e2cd9b0000000001cfa2e82e7d17bfc7fae8f87f5003d9d20000009447e914a23f4884303ee84fdd0e977c000a000000000000000000261e287aa130f143d449a751019536c09b004400000015d5895d00000000000058b58b006f4537e2801540000000000000000000126926962018336c09b00440000000000000000000058b58b72e8f8a3ea84c7c51f54355bf140028000000000000000000003e9101f97668000000000000000000000000000000000000e64e9ae64b00028000000000000000000000000000000000212858b001ab14f4005000000067b019e00000000000089200f166cd8000000000e7d174173e8bdfe3fd747c3fa801ece90000004a23f48a511fa442181f7427ee874bbe0005000000000000000000130f143d509878a1ea24d3a880ca9b604d80220000000aeac4ae8000000000002c5ac58037a29bf1400aa00000000000000000000934934b100c19b604d8022000000000000000000002c5ac5b9747c51f54263e28faa1aadf8a0014000000000000000000001f4880fcbb3400000000000000000000000000000000000073274d68aa86cfef527dd27f55814f170aa1b3fbd49f749fd4aa1b3fbd49f749fd57714f170aa1b3fbd49f749fd4aa1b3fbd49f749fd4dc53c5c2a86cfef527dd27f52a86cfef527dd27f53714f170aa1b3fbd49f749fd4aa1b3fbd49f749fd4dc53c5c2a86cfef527dd27f52a86cfef527dd27f53714f170aa1b3fbd49f749fd4aa1b3fbd49f749fd4dc53c5c2a86cfef527dd27f52a86cfef527dd27f53714f170aa1b3fbd49f749fd4aa1b3fbd49f749fd4dc53c5c2a86cfef527dd27f553c00000000004250b160035629e800a0000000cf6033c00000000000112401e2cd9b0000000001cfa2e82e7d17bfc7fae8f87f5003d9d20000009447e914a23f4884303ee84fdd0e977c000a000000000000000000261e287aa130f143d449a751019536c09b004400000015d5895d00000000000058b58b006f4537e2801540000000000000000000126926962018336c09b00440000000000000000000058b58b72e8f8a3ea84c7c51f54355bf140028000000000000000000003e9101f97668000000000000000000000000000000000000000000000000000000000000000e64e9ae64b00028000000212858b001ab14f4005000000067b019e00000000000089200f166cd8000000000e7d174173e8bdfe3fd747c3fa801ece90000004a23f48a511fa442181f7427ee874bbe0005000000000000000000130f143d509878a1ea24d3a880ca9b604d80220000000aeac4ae8000000000002c5ac58037a29bf1400aa00000000000000000000934934b100c19b604d8022000000000000000000002c5ac5b9747c51f54263e28faa1aadf8a0014000000000000000000001f4880fcbb3400000000000000000000000000000000000000000000000000000000000000073274d73258001400000010942c5800d58a7a002800000033d80cf0000000000004490078b366c00000000073e8ba0b9f45eff1feba3e1fd400f6748000002511fa45288fd2210c0fba13f743a5df000280000000000000000009878a1ea84c3c50f51269d440654db026c01100000005756257400000000000162d62c01bd14df8a00550000000000000000000049a49a588060cdb026c01100000000000000000000162d62dcba3e28faa131f147d50d56fc5000a000000000000000000000fa4407e5d9a0000000000000000000000000000000000000000000000000000000000000003993a6b992c000a000000084a162c006ac53d001400000019ec067800000000000224803c59b3600000000039f45d05cfa2f7f8ff005d1f0fea007b3a4000001288fd229447e9108607dd09fba1d2ef800140000000000000000004c3c50f54261e287a8934ea2032a6d813600880000002bab12ba000000000000b16b1600de8a6fc5002a8000000000000000000024d24d2c403066d8136008800000000000000000000b16b16e5d1f147d5098f8a3ea86ab7e280050000000000000000000007d2203f2ecd0000000000000000000000000000000000000000000000000000000000000001cc9d35cc96000500000004250b160035629e800a0000000cf6033c00000000000112401e2cd9b0000000001cfa2e82e7d17bfc7fae9f87f5003d9d00000009447e914a23f4884303ee84fdd0e977c000a000000000000000000261e287aa130f143d449a751019536c09b004400000015d5895d00000000000058b58b006f4537e2801540000000000000000000126926962018336c09b00440000000000000000000058b58b72e8f8a3ea84c7c51f54355bf140028000000000000000000003e9101f97668000000000000000000000000000000000000000000000000000000000000000a7d50da1dea37ba57eab800a7d50da1dea37ba57ea550da1dea37ba57eab80bb8a7d50da1dea37ba57ea550da1dea37ba57eab806e29f5436877a8dee95fa95436877a8dee95faae01b8a7d50da1dea37ba57ea550da1dea37ba57eab806e29d54368f7a8dee95fa954368f7a8dee95faae23d7bf5e577953aa86d1ef51bdd2bf52a86d1ef51bdd2bf55c43bf5e4de54eaa1b47bd46f74afd4aa1b47bd46f74afd5710efd7937953aa86d1ef51bdd2bf52a86d1ef51bdd2bf55c43bf5e4de54eaa1b47bd46f74afd582bfa8077ebc9bc801dfaf26f20077ebc9bc801dfaf26f200b1f7d79266760075c533e6c00000000055eac533fdff00eb31ee9592d03eb4ea9d34fbd3ae74d2af5629bde98f74ac8ab14def4c7ba564b40fbedd4fbeed4abd58a6f7a63dd2b22ac537bd31ee9592d01dba8eed4abd58a6f7a63dd2b22ac537bd31ee9592d01dba8eed4abd58a6f7a63dd2b223fe2f4d8c3ff698be564b4076ea3bb529f1ff000ea6f9898be56454da6f9898be564b80faefd6fbf57d14fa9d4df31317cac8a9d4df31317cac9700efd6beafaa9f53a9be6262f959153a9be6262f9592e01dfacf57d54fa9d4df31317cac8a9d4df31317cac9700efd67abeaa7d4ea6f9898be56454ea6f9898be564b8077eb3d5f553ea7537cc4c5f2b22a7537cc4c5f2b25c03bf59eafaa9f53a9be6262f959153a9be6262f9592e01dfacf57d54fa9d4df31317cac8a9d4df31317cac9700efd67abeaa7d4da6f9898be56443fc3a9bfee11e2262f9592e01dfad3d5f400783980000000005756257400000000000162d62c01bd14df8a00550000000000000000000049a49a588060cdb026c011000000000000000000000294f8ff87537fdff00be2262f95915369be6262f9592e03dfbf5ba7d5f453ea7537cc4c5f2b22a7537cc4c5f2b25c03bf5afabeaa7d4ea6f9898be56454ea6f9898be564b8077eb3d5f553ea7537cc4c5f2b22a7537cc4c5f2b25c03bf59eafaa9f53a9be6262f959153a9be6262f9592e01dfacf57d54fa9d4df31317cac8a9d4df31317cac9700efd67abeaa7d4ea6f9898be56454ea6f9898be564b8077eb3d5f553ea7537cc4c5f2b22a7537cc4c5f2b25c03bf59eafaa9f53a9be6262f959153a9be6262f9592e01dfacf57d57f018cf50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001405fd4000000000000022c9a0068c53826c01400000000000000000000000000000000000000000000000000000000000015d5895d00000000000058b58b006f4537e2801540000000000000000000126926962018336c09b00440000000000000000000000000000000000000000000000005fc066bbc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005017f5000000000000008b26801a314e09b00500000000000000000000000000000000000000000000000000000000000005756257400000000000162d62c01bd14df8a00550000000000000000000049a49a588060cdb026c01100000000000000000000000000000000000000000000000017f019aef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001405fd4000000000000022c9a0068c53826c01400000000000000000000000000000000000000000000000000000000000015d5895d00000000000058b58b006f4537e2801540000000000000000000126926962018336c09b00440000000000000000000000000000000000000000000000005fc066bbc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005017f5000000000000008b26801a314e09b00500000000000000000000000000000000000000000000000000000000000005756257400000000000162d62c01bd14df8a00550000000000000000000049a49a588060cdb026c01100000000000000000000000000000000000000000000000017f019aef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001405fd4000000000000022c9a0068c53826c01400000000000000000000000000000000000000000000000000000000000015d5895d00000000000058b58b006f4537e2801540000000000000000000126926962018336c09b00440000000000000000000000000000000000000000000000005fc066bbc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005017f5000000000000008b26801a314e09b00500000000000000000000000000000000000000000000000000000000000005756257400000000000162d62c01bd14df8a00550000000000000000000049a49a588060cdb026c01100000000000000000000000000000000000000000000000017f019aef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001405fd4000000000000022c9a0068c53826c01400000000000000000000000000000000000000000000000000000000000015d5895d00000000000058b58b006f4537e2801540000000000000000000126926962018336c09b00440000000000000000000000000000000000000000000000005fc066bbc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005017f5000000000000008b26801a314e09b00500000000000000000000000000000000000000000000000000000000000005756257400000000000162d62c01bd14df8a00550000000000000000000049a49a588060cdb026c01100000000000000000000000000000000000000000000000017f019aef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001405fdcc9620670c10d8670c10d8670c10d8670c142c47fd19e30069c68ff8f2e8fd678c00e079ff0059e30038279ff59e300381e7fd678c00e079ff0059e300381e7fd678c00e079ff59e300381e7fd678c00e079ff0059e300381e7fd678c00e079ff59e300381e7fd678c00e079ff0059e300381e7fd678c00e079ff59e300381e7fd678c00e079ff0059e300381e7fd678c00e079ff59e300381e7fd678c00e079ff0059e300381e7fd67abad98703cffad60d98703cff00ad60d98703cffad60d98703cff00ad60d98b1a7feac7c3fedb583663be3ff56dfc77c7d768a6b06cc3d5f8bddf8d60d987abf0eefc6b06cc3d5f8777e3583661eafc3bbf1ac1b30f57e1ddf8d60d987abf0eefc6b06cc3d5f8777e35836613ff00ab78a49faef0cf18038274ff00d704fc3f59e3004e079ff59e30038279ff0059e300381e7fd678c00e079ff59e300381e7fd678c00e079ff0059e300381e7fd678c00e079ff59e300381e7fd678c00e079ff0059e300381e7fd678c00e079ff59e300381e7fd678c00e079ff0059e300381e7fd678c00e079ff59e300381e7fd74e0194f60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001cc9d35cc96000500000004250b160035629e800a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003a700c6798000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e64e9ae64b00028000000212858b001ab14f40050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d380633cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000073274d73258001400000010942c5800d58a7a0028000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e9c0319e60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003993a6b992c000a000000084a162c006ac53d001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000074e018cf30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001cc9d35cc96000500000004250b160035629e800a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003a700c6798000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e64e9ae64b00028000000212858b001ab14f40050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d380633cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000073274d73258001400000010942c5800d58a7a0028000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e9c0319e60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003993a6b992c000a000000084a162c006ac53d001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000074e018cf30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001cc9d35cc96000500000004250b160035629e800a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003a700c6798000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e64e9ae64b00028000000212858b001ab14f40050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d380633cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000073274d73258001400000010942c5800d58a7a0028000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e9c0319e60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003993a6b992c000a000000084a162c006ac53d001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000074e018cf30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001cc9d35cc96000500000004250b160035629e800a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003a700c6798000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e64e9ae64b00028000000212858b001ab14f40050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d380633cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000073274d73258001400000010942c5800d58a7a0028000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e9c0319e60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003993a6b992c000a000000084a162c006ac53d001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000074e018cf30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001cc9d35cc96000500000004250b160035629e800a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003a700c6798000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e64e9ae64b00028000000212858b001ab14f40050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001fffd9, 'approved', '2025-05-15 07:34:55', NULL);

--
-- Triggers `paymenttransactions`
--
DELIMITER $$
CREATE TRIGGER `after_payment_approval` AFTER UPDATE ON `paymenttransactions` FOR EACH ROW BEGIN
  IF NEW.paymentStatus = 'approved' AND OLD.paymentStatus = 'pending' AND NEW.module_id IS NOT NULL THEN
    UPDATE ModulePurchases
    SET status = 'active'
    WHERE payment_id = NEW.payment_id;
    
    -- Also track in training progress
    INSERT IGNORE INTO GuideTrainingProgress (
      guide_id, 
      module_id, 
      status
    )
    SELECT 
      pg.guide_id, 
      NEW.module_id, 
      'in progress'
    FROM ModulePurchases mp
    JOIN Users u ON mp.user_id = u.user_id
    JOIN ParkGuides pg ON u.user_id = pg.user_id
    WHERE mp.payment_id = NEW.payment_id;
  END IF;
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Stand-in structure for view `pendingmodulepayments`
-- (See below for the actual view)
--
CREATE TABLE `pendingmodulepayments` (
`payment_id` int(11)
,`user_id` int(11)
,`user_name` varchar(511)
,`email` varchar(255)
,`module_id` int(11)
,`module_name` varchar(255)
,`amountPaid` decimal(10,2)
,`paymentMethod` enum('debit','credit','e_wallet')
,`transaction_date` timestamp
);

-- --------------------------------------------------------
--
-- Table structure for table `quizattempts`
--

CREATE TABLE IF NOT EXISTS `quizattempts` (
  `attempt_id` int(11) NOT NULL,
  `quiz_id` int(11) NOT NULL,
  `user_id` int(11) NOT NULL,
  `guide_id` int(11) NOT NULL,
  `start_time` timestamp NOT NULL DEFAULT current_timestamp(),
  `end_time` timestamp NULL DEFAULT NULL,
  `score` int(11) DEFAULT NULL,
  `passed` tinyint(1) DEFAULT NULL,
  `attempt_number` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Triggers `quizattempts`
--
DELIMITER $$
CREATE TRIGGER `after_quiz_completion` AFTER UPDATE ON `quizattempts` FOR EACH ROW BEGIN
  DECLARE module_id_val INT;
  
  IF NEW.passed = TRUE AND (OLD.passed IS NULL OR OLD.passed = FALSE) THEN
    -- Get the module_id for this quiz
    SELECT module_id INTO module_id_val FROM Quizzes WHERE quiz_id = NEW.quiz_id;
    
    -- Update module progress
    UPDATE GuideTrainingProgress 
    SET status = 'Completed', completion_date = CURDATE()
    WHERE guide_id = NEW.guide_id AND module_id = module_id_val;
    
    -- If progress record doesn't exist, create it
    IF ROW_COUNT() = 0 THEN
      INSERT INTO GuideTrainingProgress (guide_id, module_id, status, completion_date)
      VALUES (NEW.guide_id, module_id_val, 'Completed', CURDATE());
    END IF;
    
    -- Also update completion percentage in ModulePurchases
    UPDATE ModulePurchases mp
    JOIN Users u ON u.user_id = mp.user_id
    JOIN ParkGuides pg ON pg.user_id = u.user_id
    SET mp.completion_percentage = 100.00
    WHERE pg.guide_id = NEW.guide_id AND mp.module_id = module_id_val;
  END IF;
END
$$
DELIMITER ;

-- --------------------------------------------------------
--
-- Table structure for table `quizzes`
--

CREATE TABLE IF NOT EXISTS `quizzes` (
  quiz_id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

--
-- Dumping data for table `quizzes`
--
INSERT INTO quizzes (name, description) VALUES
('Language Basics Quiz', 'Quiz for evaluating basic language and communication skills'),
('Wildlife Knowledge Quiz', 'Test knowledge of local flora and fauna'),
('Tour Organization Quiz', 'Assess skills in planning and managing tours'),
('Visitor Engagement Quiz', 'Evaluate techniques for engaging visitors'),
('Safety Procedures Quiz', 'Test understanding of safety protocols');
-- --------------------------------------------------------
--
-- Table structure for table `questions`
--

CREATE TABLE IF NOT EXISTS `questions` (
  `question_id` INT PRIMARY KEY AUTO_INCREMENT,
  `quiz_id` INT NOT NULL,
  `type` VARCHAR(50) NOT NULL, -- 'multiple-choice', 'true-false', etc.
  `text` TEXT NOT NULL,
  `explanation` TEXT,
  `points` INT DEFAULT 1,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (quiz_id) REFERENCES quizzes(quiz_id) ON DELETE CASCADE
);

--
-- Dumping data for table `questions`
--
INSERT INTO questions (quiz_id, type, text, explanation, points) VALUES
(1, 'multiple-choice', 'What should you do if you encounter a bear in the park?', 'Backing away slowly while facing the bear is the safest approach. Running may trigger the bear''s chase instinct.', 1),
(1, 'true-false', 'It is safe to feed the wildlife in the park.', 'Feeding wildlife is dangerous for both animals and humans. It can cause animals to lose their natural fear of humans and become aggressive.', 2);
-- --------------------------------------------------------
-- Table: Options Table for Question Choices
CREATE TABLE IF NOT EXISTS `options` (
  `options_id` INT PRIMARY KEY AUTO_INCREMENT,
  `question_id` INT NOT NULL,
  `text` VARCHAR(255) NOT NULL,
  `is_correct` BOOLEAN DEFAULT FALSE,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (question_id) REFERENCES questions(question_id) ON DELETE CASCADE
);

--
-- Dumping data for table `options`
--
INSERT INTO options (question_id, text, is_correct) VALUES
(1, 'Back away slowly while facing the bear', TRUE),
(1, 'Run away as fast as you can', FALSE),
(1, 'Climb a tree immediately', FALSE),
(1, 'Approach the bear and make loud noises', FALSE),
(2, 'True', FALSE),
(2, 'False', TRUE);


-- --------------------------------------------------------
--
-- Table structure for table `quizresponses`
--

CREATE TABLE IF NOT EXISTS `quizresponses` (
  `response_id` int(11) NOT NULL,
  `attempt_id` int(11) NOT NULL,
  `question_id` int(11) NOT NULL,
  `selected_option_id` int(11) DEFAULT NULL,
  `is_correct` tinyint(1) DEFAULT NULL,
  `points_awarded` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `trainingmodules`
--

CREATE TABLE IF NOT EXISTS `trainingmodules` (
  `module_id` INT AUTO_INCREMENT PRIMARY KEY,
  `module_code` VARCHAR(10) NOT NULL UNIQUE,  
  `module_name` VARCHAR(255) NOT NULL,      
  `description` TEXT,            
  `difficulty` ENUM('beginner', 'intermediate', 'advanced') NOT NULL,  
  `aspect` ENUM('language', 'knowledge', 'organization', 'engagement', 'safety') NOT NULL, 
  `video_url` VARCHAR(255),
  `course_content` LONGTEXT,
  `quiz_id` INT,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `price` decimal(10,2) NOT NULL DEFAULT 0.00,
  `is_compulsory` BOOLEAN DEFAULT FALSE,
  FOREIGN KEY (`quiz_id`) REFERENCES `quizzes`(`quiz_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `trainingmodules`
--

-- Dummy Training Modules Data that reference the quizzes
INSERT INTO `trainingmodules` (module_code, module_name, description, difficulty, aspect, video_url, course_content, quiz_id, is_compulsory, price) VALUES
('PKG101', 'Park Guide Basics', 'Introduction to the role and responsibilities of a park guide.', 'beginner', 'knowledge', 'https://www.youtube.com/watch?v=3fumBcKC6RE', 'This module covers the basics of being a park guide, including responsibilities and expectations.', 1, TRUE, 100.00),
('ENG201', 'Visitor Engagement Techniques', 'Effective techniques for engaging with park visitors.', 'intermediate', 'engagement', 'https://www.youtube.com/watch?v=3fumBcKC6RE', 'Learn effective techniques for engaging with park visitors.', 2, TRUE, 100.00),
('KNW102', 'Flora and Fauna Identification', 'Identifying local flora and fauna in the park.', 'beginner', 'knowledge', 'https://www.youtube.com/watch?v=3GwjfUFyY6M', 'This module focuses on identifying local flora and fauna in the park.', 1, FALSE, 0.00),
('ORG102', 'Organization Skills for Guides', 'Essential skills for organizing tours and activities.', 'intermediate', 'organization', 'https://www.youtube.com/watch?v=2Z4m4lnjxkY', 'Learn essential organization skills for planning and executing tours.', 2, FALSE, 0.00),
('SAF101', 'Safety Awareness Basics', 'Introduction to safety awareness in outdoor environments.', 'beginner', 'safety', 'https://www.youtube.com/watch?v=dQw4w9WgXcQ', 'This module covers the basics of safety awareness in outdoor environments.', 1, FALSE, 0.00),
('ENG202', 'Engagement Strategies', 'Techniques for engaging with park visitors effectively.', 'intermediate', 'engagement', 'https://www.youtube.com/watch?v=SsUn8aAbU6g', 'This module provides strategies for engaging with park visitors effectively.', 2, FALSE, 0.00),
('LAN103', 'Language and Communication', 'Basic language and communication skills for park guides.', 'beginner', 'language', 'https://www.youtube.com/watch?v=3GwjfUFyY6M', 'Learn essential language and communication skills for interacting with visitors.', 1, FALSE, 0.00),
('KNW204', 'Wildlife Knowledge', 'Comprehensive overview of local flora and fauna.', 'intermediate', 'knowledge', 'https://www.youtube.com/watch?v=V-_O7nl0Ii0', 'Gain knowledge about the wildlife found in the park.', 2, FALSE, 0.00),
('ORG301', 'Tour Organization', 'Planning and managing guided tours efficiently.', 'advanced', 'organization', 'https://www.youtube.com/watch?v=2Z4m4lnjxkY', 'Master the skills needed to organize and manage tours.', 3, FALSE, 0.00),
('SAF302', 'Advanced Safety Procedures', 'Advanced safety protocols and emergency response.', 'advanced', 'safety', 'https://www.youtube.com/watch?v=DLzxrzFCyOs', 'Learn advanced safety procedures and emergency response techniques.', 5, FALSE, 0.00);

-- --------------------------------------------------------
--
-- Table structure for table `modulepurchases`
--

CREATE TABLE IF NOT EXISTS `modulepurchases` (
  `purchase_id` int(11) NOT NULL PRIMARY KEY AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `module_id` int(11) NOT NULL,
  `payment_id` int(11) NOT NULL,
  `purchase_date` timestamp NOT NULL DEFAULT current_timestamp(),
  `is_active` tinyint(1) DEFAULT 1,
  `status` enum('pending','active','revoked') DEFAULT 'pending',
  `completion_percentage` decimal(5,2) DEFAULT 0.00,
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  FOREIGN KEY (module_id) REFERENCES trainingmodules(module_id),
  FOREIGN KEY (payment_id) REFERENCES paymenttransactions(payment_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Triggers `modulepurchases`
--
DELIMITER $$
CREATE TRIGGER `after_module_purchase_creation` AFTER INSERT ON `modulepurchases` FOR EACH ROW BEGIN
  DECLARE guide_id INT;
  
  -- Find guide_id for the user who purchased the module
  SELECT pg.guide_id INTO guide_id
  FROM ParkGuides pg
  WHERE pg.user_id = NEW.user_id
  LIMIT 1;
  
  -- If guide_id found, insert a record into GuideTrainingProgress
  IF guide_id IS NOT NULL THEN
    INSERT IGNORE INTO GuideTrainingProgress
      (guide_id, module_id, status, start_date)
    VALUES
      (guide_id, NEW.module_id, 'in progress', CURRENT_DATE());
  END IF;
END
$$
DELIMITER ;

-- --------------------------------------------------------
--
-- Stand-in structure for view `usermoduleaccess`
-- (See below for the actual view)
--
CREATE TABLE `usermoduleaccess` (
`purchase_id` int(11)
,`user_id` int(11)
,`uid` varchar(255)
,`first_name` varchar(255)
,`last_name` varchar(255)
,`module_id` int(11)
,`module_name` varchar(255)
,`status` enum('pending','active','revoked')
,`purchase_date` timestamp
,`completion_percentage` decimal(5,2)
,`payment_id` int(11)
,`paymentStatus` enum('pending','approved','rejected')
);

-- --------------------------------------------------------
-- Table structure for table `parkguides`
--

CREATE TABLE IF NOT EXISTS `parkguides` (
  `guide_id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `user_id` int(11) NOT NULL,
  `certification_status` enum('pending','certified','expired') DEFAULT 'pending',
  `license_expiry_date` date DEFAULT NULL,
  `assigned_park` varchar(255) DEFAULT NULL,
  FOREIGN KEY (user_id) REFERENCES users(user_id)
);

--
-- Dumping data for table `parkguides`
--

INSERT INTO `parkguides` (`guide_id`, `user_id`, `certification_status`, `license_expiry_date`, `assigned_park`) VALUES
(1, 2, 'pending', '2026-05-15', 'Unassigned');

-- --------------------------------------------------------

--
-- Table structure for table `visitorfeedback`
--

-- Table: Visitor Feedback Table
CREATE TABLE IF NOT EXISTS `visitorfeedback` (
  `feedback_id` INT AUTO_INCREMENT PRIMARY KEY,
  `first_name` VARCHAR(255) NOT NULL,
  `last_name` VARCHAR(255) NOT NULL,
  `telephone` VARCHAR(20),
  `email` VARCHAR(255) NOT NULL,
  `ticket_no` VARCHAR(50) NOT NULL,
  `park` VARCHAR(255) NOT NULL,
  `visit_date` DATE NOT NULL,
  `guide_id` INT NOT NULL,
  `language_rating` INT NOT NULL,
  `knowledge_rating` INT NOT NULL,
  `organization_rating` INT NOT NULL,
  `engagement_rating` INT NOT NULL,
  `safety_rating` INT NOT NULL,
  `comment` TEXT,
  `submitted_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`guide_id`) REFERENCES `parkguides`(`guide_id`)
);

--
-- Dumping data for table `visitorfeedback`
--

INSERT INTO `visitorfeedback` 
(first_name, last_name, telephone, email, ticket_no, park, visit_date, guide_id, language_rating, knowledge_rating, organization_rating, engagement_rating, safety_rating, comment) 
VALUES 
('John', 'Smith', '+60123456789', 'john.smith@email.com', 'SW10001', 'Semenggoh Wildlife Centre', '2025-05-15', 1, 5, 4, 5, 5, 4, 'Excellent experience! The guide was very knowledgeable about orangutans and made the tour engaging.'),
('Emma', 'Johnson', '+60187654321', 'emma.j@email.com', 'SW10002', 'Semenggoh Wildlife Centre', '2025-05-18', 1, 4, 5, 4, 5, 5, 'Very informative tour. The safety briefing was thorough and I felt secure throughout the visit.'),
('Raj', 'Patel', '+60192345678', 'raj.patel@email.com', 'SW10003', 'Semenggoh Wildlife Centre', '2025-05-19', 1, 5, 5, 4, 4, 5, 'Amazing experience watching the orangutans. The guide was very professional and answered all our questions.'),
('Maria', 'Garcia', '+60176543210', 'maria.g@email.com', 'SW10004', 'Semenggoh Wildlife Centre', '2025-05-20', 1, 4, 5, 5, 5, 5, 'Outstanding tour! The guide was passionate about wildlife conservation and made the experience memorable.');

-- --------------------------------------------------------

--
-- Table structure for table `plant_info`
--

CREATE TABLE IF NOT EXISTS `plantinfo` (
  `plant_id` int(11) NOT NULL AUTO_INCREMENT,
  `common_name` varchar(100) NOT NULL,
  `scientific_name` varchar(100) NOT NULL,
  `family` varchar(100) NOT NULL,
  `description` text NOT NULL,
  `image_url` varchar(255) NOT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`plant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `plant_info`
--

INSERT INTO `plantinfo` (`common_name`, `scientific_name`, `family`, `description`, `image_url`) VALUES
('Spider Lily', 'Hymenocallis littoralis', 'Amaryllidaceae', 'The Spider Lily is a stunning tropical plant known for its elegant, spider-like white flowers with long, delicate petals. Native to tropical regions, it thrives in warm, humid environments and produces fragrant blooms throughout the growing season. The plant plays an important role in local ecosystems and is valued for both its ornamental beauty and cultural significance.', 'https://en.whu.edu.cn/__local/E/BB/0A/C72D750AC39F58D1F4DD1D85605_070A1AAE_7F0E.jpg'),
('Night Queen of Flowers', 'Epiphyllum oxypetalum', 'Cactaceae', 'The Night Queen of Flowers, also known as the Queen of the Night, is a spectacular nocturnal blooming cactus. This epiphytic cactus produces large, white, highly fragrant flowers that bloom only at night and wilt by dawn. Each flower can reach up to 30 cm in length, making it one of the most impressive night-blooming plants in our collection. Its rare blooming pattern and ethereal beauty make it a highly sought-after specimen in botanical gardens.', 'https://www.southsideblooms.com/wp-content/uploads/2022/05/NightQueenofFlowers.jpg'),
('Rafflesia', 'Rafflesia arnoldii', 'Rafflesiaceae', 'Known as the corpse flower, the Rafflesia is the largest individual flower in the world and is native to the rainforests of Borneo. This parasitic plant produces massive blooms that can reach up to 3 feet in diameter. The flower is famous for its distinctive appearance and its strong odor, which attracts pollinators. Despite its size and significance, the Rafflesia has no stems, leaves, or roots, making it one of the most unique specimens in our botanical collection.', 'https://cdn.shortpixel.ai/spai2/q_glossy+w_1082+to_auto+ret_img/www.fauna-flora.org/wp-content/uploads/2023/06/our-green-planet-resplendent-rafflesia-reigns-supreme-scaled.jpg'),
('Cattleya Orchid', 'Cattleya labiata', 'Orchidaceae', 'The Cattleya Orchid, often referred to as the "Queen of Orchids," is renowned for its large, showy blooms and intense fragrance. Native to tropical Americas, these epiphytic orchids produce spectacular flowers in shades of purple, pink, and white, often with frilled lips and intricate patterns. Each bloom can last several weeks, and the plants typically flower once or twice a year. In our collection, these orchids demonstrate the incredible diversity of the orchid family and serve as stunning examples of tropical flora adaptation.', 'https://www.better-gro.com/uploads/1/0/3/0/103066208/shutterstock-199188980-e1428327243456_orig.jpg');

-- --------------------------------------------------------

--
-- Structure for view `pendingmodulepayments`
--
DROP TABLE IF EXISTS `pendingmodulepayments`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `pendingmodulepayments`  AS SELECT `pt`.`payment_id` AS `payment_id`, `u`.`user_id` AS `user_id`, concat(`u`.`first_name`,' ',`u`.`last_name`) AS `user_name`, `u`.`email` AS `email`, `tm`.`module_id` AS `module_id`, `tm`.`module_name` AS `module_name`, `pt`.`amountPaid` AS `amountPaid`, `pt`.`paymentMethod` AS `paymentMethod`, `pt`.`transaction_date` AS `transaction_date` FROM ((`paymenttransactions` `pt` join `users` `u` on(`pt`.`user_id` = `u`.`user_id`)) join `trainingmodules` `tm` on(`pt`.`module_id` = `tm`.`module_id`)) WHERE `pt`.`paymentStatus` = 'pending' AND `pt`.`module_id` is not null ;

-- --------------------------------------------------------

--
-- Structure for view `usermoduleaccess`
--
DROP TABLE IF EXISTS `usermoduleaccess`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `usermoduleaccess`  AS SELECT `mp`.`purchase_id` AS `purchase_id`, `u`.`user_id` AS `user_id`, `u`.`uid` AS `uid`, `u`.`first_name` AS `first_name`, `u`.`last_name` AS `last_name`, `tm`.`module_id` AS `module_id`, `tm`.`module_name` AS `module_name`, `mp`.`status` AS `status`, `mp`.`purchase_date` AS `purchase_date`, `mp`.`completion_percentage` AS `completion_percentage`, `pt`.`payment_id` AS `payment_id`, `pt`.`paymentStatus` AS `paymentStatus` FROM (((`modulepurchases` `mp` join `users` `u` on(`mp`.`user_id` = `u`.`user_id`)) join `trainingmodules` `tm` on(`mp`.`module_id` = `tm`.`module_id`)) join `paymenttransactions` `pt` on(`mp`.`payment_id` = `pt`.`payment_id`)) WHERE `mp`.`is_active` = 1 AND `mp`.`status` = 'active' ;

-- --------------------------------------------------------

--
-- Structure for view `usermoduleaccessbyuid`
--

DROP VIEW IF EXISTS `usermoduleaccessbyuid`;
CREATE VIEW `usermoduleaccessbyuid` AS
SELECT 
    `mp`.`purchase_id`,
    `u`.`uid`,
    `tm`.`module_id`,
    `tm`.`module_name`,
    `tm`.`description`,
    `tm`.`price`,
    `mp`.`status`,
    `mp`.`purchase_date`,
    `mp`.`completion_percentage`,
    `pt`.`payment_id`,
    `pt`.`paymentStatus`
FROM 
    `modulepurchases` `mp`
    JOIN `users` `u` ON `mp`.`user_id` = `u`.`user_id`
    JOIN `trainingmodules` `tm` ON `mp`.`module_id` = `tm`.`module_id`
    JOIN `paymenttransactions` `pt` ON `mp`.`payment_id` = `pt`.`payment_id`
WHERE 
    `mp`.`is_active` = 1;
    
-- --------------------------------------------------------

--
-- Structure for view `moduleprogressbyguide`
--

DROP VIEW IF EXISTS `moduleprogressbyguide`;
CREATE VIEW `moduleprogressbyguide` AS
SELECT 
    `gtp`.`progress_id`,
    `pg`.`guide_id`,
    `u`.`uid`,
    `u`.`first_name`,
    `u`.`last_name`,
    `tm`.`module_id`,
    `tm`.`module_name`,
    `gtp`.`status`,
    `gtp`.`start_date`,
    `gtp`.`completion_date`,
    `mp`.`completion_percentage`
FROM 
    `guidetrainingprogress` `gtp`
    JOIN `parkguides` `pg` ON `gtp`.`guide_id` = `pg`.`guide_id`
    JOIN `users` `u` ON `pg`.`user_id` = `u`.`user_id`
    JOIN `trainingmodules` `tm` ON `gtp`.`module_id` = `tm`.`module_id`
    LEFT JOIN `modulepurchases` `mp` ON `mp`.`user_id` = `u`.`user_id` AND `mp`.`module_id` = `tm`.`module_id`
WHERE 
    `mp`.`is_active` = 1 OR `mp`.`is_active` IS NULL;

--
-- Structure for view `usermodulequizprogress`
--

DROP VIEW IF EXISTS `usermodulequizprogress`;
CREATE VIEW `usermodulequizprogress` AS
SELECT 
    `u`.`uid`,
    `u`.`user_id`,
    `u`.`first_name`,
    `u`.`last_name`,
    `tm`.`module_id`,
    `tm`.`module_name`,
    `q`.`quiz_id`,
    `q`.`name` AS `quiz_title`,
    `qa`.`attempt_id`,
    `qa`.`score`,
    `qa`.`passed`,
    `qa`.`attempt_number`,
    `qa`.`start_time` AS `attempt_start_time`,
    `qa`.`end_time` AS `attempt_end_time`,
    `mp`.`completion_percentage`
FROM 
    `users` `u`
    JOIN `modulepurchases` `mp` ON `u`.`user_id` = `mp`.`user_id`
    JOIN `trainingmodules` `tm` ON `mp`.`module_id` = `tm`.`module_id`
    JOIN `quizzes` `q` ON `tm`.`quiz_id` = `q`.`quiz_id`
    LEFT JOIN `quizattempts` `qa` ON `q`.`quiz_id` = `qa`.`quiz_id` AND `u`.`user_id` = `qa`.`user_id`
WHERE 
    `mp`.`is_active` = 1 AND `mp`.`status` = 'active';

-- --------------------------------------------------------

--
-- Stored procedures for module management
--

DELIMITER $$

--
-- Procedure to get all modules available for a user (purchased and available to purchase)
--
DROP PROCEDURE IF EXISTS `GetUserModuleStatus`$$
CREATE PROCEDURE `GetUserModuleStatus` (IN user_uid VARCHAR(255))
BEGIN
    -- Get user ID from UID
    DECLARE user_id_var INT;
    
    SELECT user_id INTO user_id_var
    FROM users
    WHERE uid = user_uid;
    
    -- If user exists, get module information
    IF user_id_var IS NOT NULL THEN
        -- Get all modules, with purchase status
        SELECT 
            tm.module_id,
            tm.module_name,
            tm.description,
            tm.price,
            tm.is_premium,
            CASE 
                WHEN mp.purchase_id IS NOT NULL THEN 'purchased'
                ELSE 'available'
            END AS purchase_status,
            IFNULL(mp.completion_percentage, 0) AS completion_percentage,
            IFNULL(mp.status, 'not_purchased') AS module_status,
            IFNULL(mp.purchase_date, NULL) AS purchase_date
        FROM 
            trainingmodules tm
            LEFT JOIN (
                SELECT mp.* 
                FROM modulepurchases mp 
                WHERE mp.user_id = user_id_var AND mp.is_active = 1
            ) mp ON tm.module_id = mp.module_id
        ORDER BY 
            tm.is_premium ASC, 
            tm.module_name ASC;
    ELSE
        -- If user doesn't exist, return empty result
        SELECT NULL AS module_id;
    END IF;
END$$

--
-- Procedure to get detailed quiz information for a module
--
DROP PROCEDURE IF EXISTS `GetModuleQuizInfo`$$
CREATE PROCEDURE `GetModuleQuizInfo` (IN module_id_param INT, IN user_uid_param VARCHAR(255))
BEGIN
    DECLARE user_id_var INT;
    
    -- Get user ID from UID
    SELECT user_id INTO user_id_var
    FROM users
    WHERE uid = user_uid_param;
    
    -- Get all quizzes for this module
    SELECT 
        q.quiz_id,
        q.title,
        q.description,
        q.pass_percentage,
        q.attempts_allowed,
        q.is_certification_quiz,
        MAX(qa.score) AS highest_score,
        CASE 
            WHEN MAX(CASE WHEN qa.passed = 1 THEN 1 ELSE 0 END) = 1 THEN 'passed'
            WHEN COUNT(qa.attempt_id) >= q.attempts_allowed THEN 'max_attempts_reached'
            WHEN COUNT(qa.attempt_id) > 0 THEN 'in_progress'
            ELSE 'not_attempted'
        END AS attempt_status,
        COUNT(qa.attempt_id) AS attempt_count
    FROM 
        quizzes q
        LEFT JOIN quizattempts qa ON q.quiz_id = qa.quiz_id AND qa.user_id = user_id_var
    WHERE 
        q.module_id = module_id_param
    GROUP BY 
        q.quiz_id, q.title, q.description, q.pass_percentage, q.attempts_allowed, q.is_certification_quiz;
END$$

--
-- Procedure to initiate module purchase process
--
DROP PROCEDURE IF EXISTS `InitiateModulePurchase`$$
CREATE PROCEDURE `InitiateModulePurchase` (
    IN user_uid_param VARCHAR(255),
    IN module_id_param INT,
    IN payment_method_param ENUM('debit', 'credit', 'e_wallet'),
    IN amount_paid_param DECIMAL(10,2),
    IN receipt_image_blob LONGBLOB
)
BEGIN
    DECLARE user_id_var INT;
    DECLARE payment_id_var INT;
    DECLARE already_purchased BOOLEAN DEFAULT FALSE;
    
    -- Transaction to ensure all operations succeed or fail together
    START TRANSACTION;
    
    -- Get user ID from UID
    SELECT user_id INTO user_id_var
    FROM users
    WHERE uid = user_uid_param;
    
    -- Check if user has already purchased the module
    SELECT COUNT(*) > 0 INTO already_purchased
    FROM modulepurchases
    WHERE user_id = user_id_var AND module_id = module_id_param AND is_active = 1;
    
    IF user_id_var IS NOT NULL AND NOT already_purchased THEN
        -- Create payment transaction record
        INSERT INTO paymenttransactions (
            user_id, 
            uid, 
            paymentPurpose, 
            paymentMethod, 
            amountPaid, 
            receipt_image, 
            paymentStatus,
            module_id
        ) VALUES (
            user_id_var,
            user_uid_param,
            'module_purchase',
            payment_method_param,
            amount_paid_param,
            receipt_image_blob,
            'pending',
            module_id_param
        );
        
        -- Get the inserted payment ID
        SET payment_id_var = LAST_INSERT_ID();
        
        -- Create module purchase record with pending status
        INSERT INTO modulepurchases (
            user_id,
            module_id,
            payment_id,
            status,
            is_active
        ) VALUES (
            user_id_var,
            module_id_param,
            payment_id_var,
            'pending',
            1
        );
        
        -- Return the payment ID for reference
        SELECT 
            'success' AS result,
            payment_id_var AS payment_id,
            'Module purchase initiated, payment pending approval' AS message;
        
        COMMIT;
    ELSE
        IF user_id_var IS NULL THEN
            SELECT 'error' AS result, 'User not found' AS message;
        ELSEIF already_purchased THEN
            SELECT 'error' AS result, 'Module already purchased by this user' AS message;
        END IF;
        
        ROLLBACK;
    END IF;
END$$

--
-- Procedure to approve a pending module payment
--
DROP PROCEDURE IF EXISTS `ApproveModulePayment`$$
CREATE PROCEDURE `ApproveModulePayment` (IN payment_id_param INT)
BEGIN
    DECLARE payment_status_var ENUM('pending', 'approved', 'rejected');
    
    -- Check current payment status
    SELECT paymentStatus INTO payment_status_var
    FROM paymenttransactions
    WHERE payment_id = payment_id_param;
    
    IF payment_status_var = 'pending' THEN
        -- Update payment status to approved
        UPDATE paymenttransactions
        SET paymentStatus = 'approved'
        WHERE payment_id = payment_id_param;
        
        -- Return success message
        SELECT 
            'success' AS result, 
            'Payment approved successfully' AS message;
    ELSE
        -- Return error if payment is not in pending state
        SELECT 
            'error' AS result, 
            CONCAT('Cannot approve payment in ', payment_status_var, ' state') AS message;
    END IF;
END$$

--
-- Procedure to reject a pending module payment
--
DROP PROCEDURE IF EXISTS `RejectModulePayment`$$
CREATE PROCEDURE `RejectModulePayment` (IN payment_id_param INT, IN rejection_reason VARCHAR(255))
BEGIN
    DECLARE payment_status_var ENUM('pending', 'approved', 'rejected');
    
    -- Check current payment status
    SELECT paymentStatus INTO payment_status_var
    FROM paymenttransactions
    WHERE payment_id = payment_id_param;
    
    IF payment_status_var = 'pending' THEN
        -- Start transaction to ensure all operations succeed or fail together
        START TRANSACTION;
        
        -- Update payment status to rejected
        UPDATE paymenttransactions
        SET 
            paymentStatus = 'rejected'
        WHERE payment_id = payment_id_param;
        
        -- Update module purchase status to revoked
        UPDATE modulepurchases
        SET 
            status = 'revoked',
            is_active = 0
        WHERE payment_id = payment_id_param;
        
        COMMIT;
        
        -- Return success message
        SELECT 
            'success' AS result, 
            'Payment rejected successfully' AS message;
    ELSE
        -- Return error if payment is not in pending state
        SELECT 
            'error' AS result, 
            CONCAT('Cannot reject payment in ', payment_status_var, ' state') AS message;
    END IF;
END$$

--
-- Procedure to update module completion percentage
--
DROP PROCEDURE IF EXISTS `UpdateModuleCompletionPercentage`$$
CREATE PROCEDURE `UpdateModuleCompletionPercentage` (
    IN user_uid_param VARCHAR(255),
    IN module_id_param INT,
    IN completion_percentage_param DECIMAL(5,2)
)
BEGIN
    DECLARE user_id_var INT;
    DECLARE module_purchase_exists BOOLEAN DEFAULT FALSE;
    
    -- Get user ID from UID
    SELECT user_id INTO user_id_var
    FROM users
    WHERE uid = user_uid_param;
    
    -- Check if user has purchased the module
    SELECT COUNT(*) > 0 INTO module_purchase_exists
    FROM modulepurchases
    WHERE user_id = user_id_var AND module_id = module_id_param AND is_active = 1 AND status = 'active';
    
    IF user_id_var IS NOT NULL AND module_purchase_exists THEN
        -- Update completion percentage
        UPDATE modulepurchases
        SET completion_percentage = completion_percentage_param
        WHERE user_id = user_id_var AND module_id = module_id_param AND is_active = 1;
        
        -- Return success message
        SELECT 
            'success' AS result, 
            'Module completion percentage updated successfully' AS message;
    ELSE
        IF user_id_var IS NULL THEN
            SELECT 'error' AS result, 'User not found' AS message;
        ELSEIF NOT module_purchase_exists THEN
            SELECT 'error' AS result, 'Active module purchase not found for this user' AS message;
        END IF;
    END IF;
END$$

DELIMITER ;